import{a as ge,b as ve,c as be}from"./chunk-DRFXQGFU.js";import{a as re}from"./chunk-ELFW3MCS.js";import{b as se,c as ce}from"./chunk-BUFGAGPR.js";import{a as ie,d as oe,e as ne,f as ae,g as le,i as pe,j as de,o as me,q as fe,r as ue}from"./chunk-BBDCSVIU.js";import{a as $}from"./chunk-D2HZNMZZ.js";import{Aa as J,Ba as K,Fa as X,Ha as Y,Ia as Z,La as ee,Na as te,O as G,Oa as S,va as z,xa as F}from"./chunk-GPXXUB3O.js";import{$b as W,D as E,Da as u,Ha as s,Hb as V,Hc as U,Kc as H,Lc as Q,Na as y,Oa as A,Pa as j,Qa as a,R as x,Ra as n,Rb as k,Sa as C,Sb as L,Va as M,W as b,X as h,Xb as q,Ya as w,_a as D,eb as B,fb as T,gb as P,j as _,kb as N,lb as l,mb as m,nb as g,oa as t,ob as O,pa as v,ub as R,yb as p,zb as d}from"./chunk-VFCAWHKN.js";function he(o,c){if(o&1&&(a(0,"mat-option",13),l(1),n()),o&2){let e=c.$implicit;s("value",e.accountId),t(),m(e.tradingIdAndName)}}function we(o,c){o&1&&(a(0,"p",20),l(1),p(2,"translate"),n()),o&2&&(t(),g(" ",d(2,1,"ACCOUNTS.OneOfTradeAccounts"),""))}function Fe(o,c){o&1&&(a(0,"mat-error",20),l(1),p(2,"translate"),n()),o&2&&(t(),g(" ",d(2,1,"login.FieldRequired"),""))}function Ce(o,c){if(o&1&&(a(0,"mat-option",13),l(1),n()),o&2){let e=c.$implicit;s("value",e),t(),O("",e.nickName," #",e.id,"")}}function Oe(o,c){o&1&&(a(0,"p",20),l(1),p(2,"translate"),n()),o&2&&(t(),g(" ",d(2,1,"ACCOUNTS.ProviderToCopyTrades")," "))}function Se(o,c){o&1&&(a(0,"mat-error",20),l(1),p(2,"translate"),n()),o&2&&(t(),g(" ",d(2,1,"login.FieldRequired")," "))}function Ie(o,c){if(o&1&&(a(0,"mat-option",13),l(1),n()),o&2){let e=c.$implicit;s("value",e),t(),m(e.name)}}function _e(o,c){o&1&&(a(0,"p",20),l(1),p(2,"translate"),n()),o&2&&(t(),g(" ",d(2,1,"ACCOUNTS.SelectOfferOfProvider")," "))}function Ee(o,c){o&1&&(a(0,"mat-error",20),l(1),p(2,"translate"),n()),o&2&&(t(),g(" ",d(2,1,"login.FieldRequired")," "))}function xe(o,c){if(o&1&&(a(0,"mat-dialog-content",6)(1,"div",21)(2,"h6"),l(3),p(4,"translate"),n(),a(5,"div",22)(6,"p"),l(7),p(8,"translate"),n(),a(9,"p"),l(10),n()(),a(11,"div",22)(12,"p"),l(13),p(14,"translate"),n(),a(15,"p"),l(16),n()()(),a(17,"div",21)(18,"h6"),l(19),p(20,"translate"),n(),a(21,"div",22)(22,"p"),l(23),p(24,"translate"),n(),a(25,"p"),l(26),n()(),a(27,"div",22)(28,"p"),l(29),p(30,"translate"),n(),a(31,"p"),l(32),n()()()()),o&2){let e=D();t(3),m(d(4,11,"HOME.Provider")),t(4),m(d(8,13,"HOME.Nickname")),t(3),m(e.getControl.providerObj.value==null?null:e.getControl.providerObj.value.nickName),t(3),m(d(14,15,"PROVIDERS_PROFILE.Visibility")),t(3),m(e.getControl.providerObj.value==null?null:e.getControl.providerObj.value.visibility),t(3),m(d(20,17,"PROVIDERS_PROFILE.Offer")),t(4),m(d(24,19,"PROVIDERS_PROFILE.Title")),t(3),m(e.getControl.offerObj.value==null?null:e.getControl.offerObj.value.name),t(3),m(d(30,21,"OFFERS.Performance fee")),t(3),O("",e.getControl.offerObj.value==null||e.getControl.offerObj.value.performance==null?null:e.getControl.offerObj.value.performance.fee,"% (",e.getControl.offerObj.value==null||e.getControl.offerObj.value.performance==null?null:e.getControl.offerObj.value.performance.interval,")")}}var Xe=(()=>{class o{cdr;_webService;fb;dialogRef;createFollowerForm;tradingIdArr=[];offersArr=[];providersData=[];showError=!1;filteredOptions;IConstant;showLoader=!1;errorComponent;constructor(e,i,r,f){this.cdr=e,this._webService=i,this.fb=r,this.dialogRef=f,this.createFollowerForm=this.fb.group({accountId:["",[F.required]],providerObj:["",[F.required]],offerObj:["",[F.required]]}),this.IConstant=new U,this.getTradingAccountDetais(),this.getAllProvidersData()}ngOnInit(){this.setProvidersAutoComplete(),this.onProviderObjEmpty()}onProviderObjEmpty(){this.getControl.providerObj.valueChanges.subscribe(e=>{typeof e=="string"&&e?.trim()===""&&(this.getControl.offerObj.setValue(""),this.getControl.offerObj.updateValueAndValidity())})}displayFn(e){return e&&e.nickName?e.nickName:""}setProvidersAutoComplete(){this.filteredOptions=this.getControl.providerObj.valueChanges.pipe(E(""),_(e=>{let i=typeof e=="string"?e.toLowerCase():e?.nickName.toLowerCase();return this.providersData.filter(r=>r.nickName.toLowerCase().includes(i))}))}getTradingAccountDetais(){let e={scope:"Active"};this._webService.getTradingAccountData(e).subscribe({next:i=>{this.tradingIdArr=i.items.map(r=>({tradingIdAndName:`${r.externalAccount} - ${r.externalName}`,accountId:r.id}))},error:i=>{this.showErrorWarnMessage(i?.error?.errorMessage)}})}getAllProvidersData(){this._webService.getAllProvidersData().subscribe({next:e=>{this.providersData=e.items.filter(i=>i.hasPublicOffers).map(i=>({nickName:i.nickname,id:i.id,visibility:i.visibility}))},error:e=>{this.showErrorWarnMessage(e?.error?.errorMessage)}})}getOffersOfProvider(){let e={id:this.getControl.providerObj.value.id};this._webService.getOffersOfProvider(e).subscribe({next:i=>{this.offersArr=i.items,this.offersArr.length>0&&this.getControl.offerObj.setValue(this.offersArr[0]),this.getControl.offerObj.updateValueAndValidity()},error:i=>{this.showErrorWarnMessage(i?.error?.errorMessage)}})}closeCreateFollowerForm(){this.dialogRef.close()}get getControl(){return this.createFollowerForm.controls}createFollowerUser(){if(this.createFollowerForm.invalid){this.showError=!0;return}this.showLoader=!0,this.showError=!1;let e={accountId:this.getControl.accountId.value,agent:{source:"ManualInput"},providerId:this.getControl.providerObj.value.id,offerId:this.getControl.offerObj.value.id};this._webService.createFollower(e).subscribe({next:i=>{this.showLoader=!1,this.showSuccessPopupMsg("Subscription has been added"),this._webService.emitOnWebDataChange({action:"follower_created",data:i})},error:i=>{this.showLoader=!1,this.showErrorWarnMessage(this.IConstant.errorMessageObj[i?.error?.errorCode]),this.cdr.detectChanges()}})}showErrorWarnMessage(e){let i=this.errorComponent?.config;i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}showSuccessPopupMsg(e){let i=this.errorComponent?.config;i.customStyle="default-success-style",i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}static \u0275fac=function(i){return new(i||o)(v(V),v($),v(ee),v(ie))};static \u0275cmp=x({type:o,selectors:[["beFollower-dialog"]],viewQuery:function(i,r){if(i&1&&B(S,5),i&2){let f;T(f=P())&&(r.errorComponent=f.first)}},standalone:!0,features:[R],decls:54,vars:42,consts:[["auto","matAutocomplete"],[1,"parent-div","d-flex","justify-space-between"],[1,"child-div-left"],["mat-dialog-title","",1,"text-center"],[1,"text-center"],[3,"formGroup"],[1,"mat-typography"],[1,"common-field"],["formControlName","accountId"],[3,"value",4,"ngFor","ngForOf"],["class","pb-10",4,"ngIf"],["type","text","formControlName","providerObj","matInput","","placeholder","Provider 1",3,"matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value"],["formControlName","offerObj"],[1,"d-flex","justify-center","g-20"],["mat-dialog-close","",1,"secondary-btn",3,"click"],["type","submit",1,"primary-btn",3,"click","IcmLoadingOverlay"],[1,"child-div-right"],["class","mat-typography",4,"ngIf"],[1,"pb-10"],[1,"pb-5"],[1,"d-flex","justify-space-between","pb-5"]],template:function(i,r){if(i&1){let f=M();a(0,"div",1)(1,"div",2)(2,"h2",3),l(3),p(4,"translate"),n(),a(5,"p",4),l(6),p(7,"translate"),n(),a(8,"form",5)(9,"mat-dialog-content",6)(10,"mat-form-field",7)(11,"mat-label"),l(12),p(13,"translate"),n(),a(14,"mat-select",8),u(15,he,2,2,"mat-option",9),n()(),u(16,we,3,3,"p",10)(17,Fe,3,3,"mat-error",10),a(18,"mat-form-field",7)(19,"mat-label"),l(20),p(21,"translate"),n(),C(22,"input",11),a(23,"mat-autocomplete",12,0),w("optionSelected",function(){return b(f),h(r.getOffersOfProvider())}),A(25,Ce,2,3,"mat-option",13,y),p(27,"async"),n()(),u(28,Oe,3,3,"p",10)(29,Se,3,3,"mat-error",10),a(30,"mat-form-field",7)(31,"mat-label"),l(32),p(33,"translate"),n(),a(34,"mat-select",14),u(35,Ie,2,2,"mat-option",9),n()(),u(36,_e,3,3,"p",10)(37,Ee,3,3,"mat-error",10),n(),a(38,"div",15)(39,"button",16),w("click",function(){return b(f),h(r.closeCreateFollowerForm())}),l(40),p(41,"translate"),n(),a(42,"button",17),w("click",function(){return b(f),h(r.createFollowerUser())}),l(43),p(44,"translate"),n()()()(),a(45,"div",18)(46,"h2",3),l(47),p(48,"translate"),n(),a(49,"p",4),l(50),p(51,"translate"),n(),u(52,xe,33,23,"mat-dialog-content",19),n()(),C(53,"show-error-message")}if(i&2){let f=N(24);t(3),m(d(4,22,"HOME.New Subscription")),t(3),m(d(7,24,"SUBSCRIPTION.CreateSubscription")),t(2),s("formGroup",r.createFollowerForm),t(4),m(d(13,26,"SUBSCRIPTION.Trading account")),t(3),s("ngForOf",r.tradingIdArr),t(),s("ngIf",!r.showError||!(r.createFollowerForm.controls.accountId.errors!=null&&r.createFollowerForm.controls.accountId.errors.required)),t(),s("ngIf",r.showError&&(r.createFollowerForm.controls.accountId.errors==null?null:r.createFollowerForm.controls.accountId.errors.required)),t(3),m(d(21,28,"HOME.Provider")),t(2),s("matAutocomplete",f),t(),s("displayWith",r.displayFn),t(2),j(d(27,30,r.filteredOptions)),t(3),s("ngIf",!r.showError||!(r.createFollowerForm.controls.providerObj.errors!=null&&r.createFollowerForm.controls.providerObj.errors.required)),t(),s("ngIf",r.showError&&(r.createFollowerForm.controls.providerObj.errors==null?null:r.createFollowerForm.controls.providerObj.errors.required)),t(3),m(d(33,32,"PROVIDERS_PROFILE.Offer")),t(3),s("ngForOf",r.offersArr),t(),s("ngIf",!r.showError||!(r.createFollowerForm.controls.offerObj.errors!=null&&r.createFollowerForm.controls.offerObj.errors.required)),t(),s("ngIf",r.showError&&(r.createFollowerForm.controls.offerObj.errors==null?null:r.createFollowerForm.controls.offerObj.errors.required)),t(3),m(d(41,34,"COMMON.Cancel")),t(2),s("IcmLoadingOverlay",r.showLoader),t(),m(d(44,36,"COMMON.Create")),t(4),m(d(48,38,"ACCOUNTS.Details")),t(3),m(d(51,40,"ACCOUNTS.InfoChosenProviderAndSubscription")),t(2),s("ngIf",r.createFollowerForm.controls.providerObj.value&&r.createFollowerForm.controls.offerObj.value&&(r.createFollowerForm.controls.providerObj.value==null?null:r.createFollowerForm.controls.providerObj.value.nickName))}},dependencies:[le,oe,ne,ae,ce,se,me,pe,de,ue,fe,G,W,k,L,q,te,X,z,J,K,Y,Z,S,be,ge,ve,Q,H,re],styles:[".beFollower-dialog{width:850px!important;border-radius:10px!important;max-width:850px!important}  .beFollower-dialog .mat-mdc-dialog-title{margin:unset!important;padding-bottom:10px!important}  .beFollower-dialog .mat-mdc-dialog-surface{border-radius:10px!important;background:#fff!important;padding:20px!important}  .beFollower-dialog .common-field{width:100%!important}  .beFollower-dialog .common-field .mdc-text-field{background-color:#fff;border:1px solid;border-bottom:0px}  .beFollower-dialog .common-field .mdc-text-field textarea{resize:none}  .beFollower-dialog .common-field .mdc-text-field .mat-mdc-form-field-text-suffix{font-size:20px}  .beFollower-dialog .parent-div{width:100%}  .beFollower-dialog .parent-div .child-div-left{width:60%;border-right:1px solid #EAECF0}  .beFollower-dialog .parent-div .child-div-right{width:40%;padding-left:10px}"],changeDetection:0})}return o})();export{Xe as a};
