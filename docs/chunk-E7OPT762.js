import{a as mt}from"./chunk-E7P3D5E6.js";import{a as pt}from"./chunk-SWRX5XN2.js";import{a as ft}from"./chunk-NEVN5C7P.js";import{a as ee}from"./chunk-ELFW3MCS.js";import{a as Ie}from"./chunk-ZMEXDH5L.js";import{a as at,b as lt,c as st,h as dt}from"./chunk-ZV3KFHQO.js";import{b as U,c as q}from"./chunk-BUFGAGPR.js";import{a as te,b as ie,c as _e,e as ne,f as oe,g as re,i as j,j as ae,l as le,o as G,q as Ce,r as W,u as ve,v as rt}from"./chunk-BBDCSVIU.js";import{a as L}from"./chunk-D2HZNMZZ.js";import{Aa as J,Ba as K,C as Ue,D as qe,E as We,Ea as tt,F as ze,Fa as H,G as Qe,Ga as N,Ha as $,Ia as Y,Ja as it,Ka as nt,La as X,Ma as ot,Na as Z,O as he,Oa as E,T as Ke,U as He,V as $e,qa as Ye,ra as Xe,sa as Ze,ta as et,va as B,xa as S}from"./chunk-GPXXUB3O.js";import{$b as R,Ab as xe,Bb as Re,Bc as Ne,Cc as je,Da as h,Ec as Ge,Ha as g,Hb as ue,Hc as Q,Kc as V,Lc as T,Ma as _,O as de,Qa as l,Qb as Le,R as M,Ra as r,Rb as Ve,Sa as u,Sb as P,Va as me,W as O,X as D,Ya as I,Zb as Te,_a as C,_b as Be,eb as y,fb as A,gb as k,kb as fe,lb as a,ma as ke,mb as m,nb as f,oa as n,ob as we,pa as x,qb as pe,rb as ce,sb as ge,tb as Pe,ub as w,wb as b,yb as s,zb as d,zc as Je}from"./chunk-VFCAWHKN.js";import{f as Ae}from"./chunk-XTLRYQGA.js";function _t(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Add")," ")}function Ct(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Update")," ")}function xt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Add")," ")}function It(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Update")," ")}function vt(t,c){t&1&&(l(0,"p",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Agent trading account's ID")," "))}function Ot(t,c){t&1&&(l(0,"mat-error",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"login.FieldRequired")," "))}function Dt(t,c){t&1&&(l(0,"mat-error",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be greater than 0")," "))}function St(t,c){t&1&&(l(0,"mat-error",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be unique")," "))}function Et(t,c){t&1&&(l(0,"p",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Agent fee paid as a percent of all fees to be received by provider")," "))}function bt(t,c){t&1&&(l(0,"mat-error",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"login.FieldRequired")," "))}function Ft(t,c){t&1&&(l(0,"mat-error",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be greater than 0")," "))}function Mt(t,c){t&1&&(l(0,"mat-error",12),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Total agent fee must not exceed 100%")," "))}function yt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Create")," ")}function At(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Save Changes")," ")}var gt=(()=>{class t{data;dialogRef;fb;_webService;cdr;createAgentForm;offerData={};offerFormData={};tempOfferFormData={};isUpdate;showError=!1;showLoader=!1;currentTotalAgentFee=0;errorComponent;IConstant=new Q;constructor(e,i,o,p,v){this.data=e,this.dialogRef=i,this.fb=o,this._webService=p,this.cdr=v,this.offerData=e.offerData,this.isUpdate=e.isUpdate,this.currentTotalAgentFee=this.getTotalAgentFee(),this.createAgentForm=this.fb.group({externalAccount:["",[S.required,S.min(1),this.uniqueAccountValidator(this.offerData.additionalAgents.chain,this.isUpdate,this.data?.offerFormData?.externalAccount)]],share:["",[S.required,S.min(1),this.totalFeeValidator(this.currentTotalAgentFee)]]}),this.setAgentFormData()}setAgentFormData(){this.isUpdate&&(this.offerFormData=JSON.parse(JSON.stringify(this.data.offerFormData)),this.tempOfferFormData=JSON.parse(JSON.stringify(this.data.offerFormData)),this.createAgentForm.get("externalAccount")?.setValue(this.offerFormData.externalAccount),this.createAgentForm.get("share")?.setValue(this.offerFormData.share),this.createAgentForm.get("externalAccount")?.updateValueAndValidity(),this.createAgentForm.get("share")?.updateValueAndValidity())}totalFeeValidator(e){return i=>{let o=i?.parent;return o&&(o.get("share")?.value||0)+e>100?{totalFeeExceeds:!0}:null}}uniqueAccountValidator(e,i,o){return p=>{let v=p?.parent;if(!v)return null;let se=v.get("externalAccount")?.value||0;return e.some(F=>i&&F.externalAccount==o?!1:F.externalAccount==se)?{agentAccountDuplicate:!0}:null}}getTotalAgentFee(){let e=0;if(this.offerData.publicAgents.fee&&(e=e+this.offerData.publicAgents.fee),this.offerData.additionalAgents.chain.length>0){let i=this.offerData.additionalAgents.chain.reduce((o,p)=>o+p.share,0);e=e+i}return e}get getControl(){return this.createAgentForm.controls}createOrUpdateAgent(){if(this.createAgentForm.invalid){this.showError=!0;return}this.showLoader=!0,this.showError=!1;let e=this.getAgentParamObj();this._webService.updateOfferData(e).subscribe({next:i=>{this.showSuccessPopupMsg("Offer has been updated"),this.dialogRef.close({action:"refresh_offer_data"}),this.showLoader=!1},error:i=>{this.showLoader=!1,this.showErrorWarnMessage(this.IConstant.errorMessageObj[i?.error?.errorCode]),this.cdr.detectChanges()}})}getAgentParamObj(){let e={},i={externalAccount:this.getControl.externalAccount.value,share:this.getControl.share.value};if(!this.isUpdate)e.additionalAgents=JSON.parse(JSON.stringify(this.offerData.additionalAgents)),e.additionalAgents.chain.push(i);else{e.additionalAgents=JSON.parse(JSON.stringify(this.offerData.additionalAgents));let o=e.additionalAgents.chain.findIndex(p=>p.externalAccount==this.tempOfferFormData.externalAccount);e.additionalAgents.chain[o]=i}return e.offerId=this.offerData.id,e}showErrorWarnMessage(e){let i=this.errorComponent?.config;i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}showSuccessPopupMsg(e){let i=this.errorComponent?.config;i.customStyle="default-success-style",i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}closeDialog(){this.dialogRef.close({})}static \u0275fac=function(i){return new(i||t)(x(ie),x(te),x(X),x(L),x(ue))};static \u0275cmp=M({type:t,selectors:[["create-offer-dialog"]],viewQuery:function(i,o){if(i&1&&y(E,5),i&2){let p;A(p=k())&&(o.errorComponent=p.first)}},standalone:!0,features:[w],decls:40,vars:28,consts:[["mat-dialog-title","",1,"text-center"],[1,"text-center"],[3,"formGroup"],[1,"mat-typography"],[1,"common-field"],["type","number","matInput","","placeholder","1000","formControlName","externalAccount"],["class","pb-10",4,"ngIf"],["type","number","matInput","","placeholder","10","formControlName","share"],["matTextSuffix",""],[1,"d-flex","justify-center","g-20"],[1,"secondary-btn",3,"click"],["type","submit",1,"primary-btn",3,"click","IcmLoadingOverlay"],[1,"pb-10"]],template:function(i,o){i&1&&(l(0,"h2",0),h(1,_t,2,3)(2,Ct,2,3),a(3),s(4,"translate"),r(),l(5,"p",1),h(6,xt,2,3)(7,It,2,3),a(8),s(9,"translate"),r(),l(10,"form",2)(11,"mat-dialog-content",3)(12,"mat-form-field",4)(13,"mat-label"),a(14),s(15,"translate"),r(),u(16,"input",5),r(),h(17,vt,3,3,"p",6)(18,Ot,3,3,"mat-error",6)(19,Dt,3,3,"mat-error",6)(20,St,3,3,"mat-error",6),l(21,"mat-form-field",4)(22,"mat-label"),a(23),s(24,"translate"),r(),u(25,"input",7),l(26,"span",8),a(27,"%"),r()(),h(28,Et,3,3,"p",6)(29,bt,3,3,"mat-error",6)(30,Ft,3,3,"mat-error",6)(31,Mt,3,3,"mat-error",6),r(),l(32,"div",9)(33,"button",10),I("click",function(){return o.closeDialog()}),a(34),s(35,"translate"),r(),l(36,"button",11),I("click",function(){return o.createOrUpdateAgent()}),h(37,yt,2,3)(38,At,2,3),r()()(),u(39,"show-error-message")),i&2&&(n(),_(o.isUpdate?2:1),n(2),f(" ",d(4,18,"PROVIDERS_PROFILE.Additional Agent")," "),n(3),_(o.isUpdate?7:6),n(2),f(" ",d(9,20,"PROVIDERS_PROFILE.an additional agent"),`
`),n(2),g("formGroup",o.createAgentForm),n(4),m(d(15,22,"COMMON.Agent")),n(3),g("ngIf",!o.showError||!(o.createAgentForm.controls.externalAccount.errors!=null&&o.createAgentForm.controls.externalAccount.errors.required)&&!(o.createAgentForm.controls.externalAccount.errors!=null&&o.createAgentForm.controls.externalAccount.errors.min)&&!(o.createAgentForm.controls.externalAccount.errors!=null&&o.createAgentForm.controls.externalAccount.errors.agentAccountDuplicate)),n(),g("ngIf",o.showError&&(o.createAgentForm.controls.externalAccount.errors==null?null:o.createAgentForm.controls.externalAccount.errors.required)),n(),g("ngIf",o.showError&&(o.createAgentForm.controls.externalAccount.errors==null?null:o.createAgentForm.controls.externalAccount.errors.min)),n(),g("ngIf",o.showError&&(o.createAgentForm.controls.externalAccount.errors==null?null:o.createAgentForm.controls.externalAccount.errors.agentAccountDuplicate)),n(3),m(d(24,24,"PROVIDERS_PROFILE.Share")),n(5),g("ngIf",!o.showError||!(o.createAgentForm.controls.share.errors!=null&&o.createAgentForm.controls.share.errors.required)&&!(o.createAgentForm.controls.share.errors!=null&&o.createAgentForm.controls.share.errors.min||o.createAgentForm.controls.share.errors!=null&&o.createAgentForm.controls.share.errors.totalFeeExceeds)),n(),g("ngIf",o.showError&&(o.createAgentForm.controls.share.errors==null?null:o.createAgentForm.controls.share.errors.required)),n(),g("ngIf",o.showError&&(o.createAgentForm.controls.share.errors==null?null:o.createAgentForm.controls.share.errors.min)),n(),g("ngIf",o.showError&&(o.createAgentForm.controls.share.errors==null?null:o.createAgentForm.controls.share.errors.totalFeeExceeds)),n(3),m(d(35,26,"COMMON.Cancel")),n(2),g("IcmLoadingOverlay",o.showLoader),n(),_(o.isUpdate?38:37))},dependencies:[re,ne,oe,q,U,G,j,ae,le,W,R,P,Z,H,B,N,J,K,$,Y,E,T,V,ee],styles:[".add-agent-dialog{width:600px!important;border-radius:10px!important}  .add-agent-dialog .mat-mdc-dialog-title{margin:unset!important;padding-bottom:10px!important}  .add-agent-dialog .mat-mdc-dialog-surface{border-radius:10px!important;background:#fff!important;padding:20px!important}  .add-agent-dialog .common-field{width:100%!important}  .add-agent-dialog .common-field .mdc-text-field{background-color:#fff;border:1px solid;border-bottom:0px}  .add-agent-dialog .common-field .mdc-text-field textarea{resize:none}  .add-agent-dialog .common-field .mdc-text-field .mat-mdc-form-field-text-suffix{font-size:20px}"],changeDetection:0})}return t})();function kt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Add Join Link")," ")}function wt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Update Join Link")," ")}function Pt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Add an offer's join link")," ")}function Rt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Update the offer's join link")," ")}function Lt(t,c){t&1&&(l(0,"p",13),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Key Hint")," "))}function Vt(t,c){t&1&&(l(0,"mat-error",13),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"login.FieldRequired")," "))}function Tt(t,c){t&1&&(l(0,"mat-error",13),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.This key is already in use")," "))}function Bt(t,c){t&1&&(l(0,"p",13),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Agent Join Link Hint")," "))}function Jt(t,c){t&1&&(l(0,"mat-error",13),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be greater than 0")," "))}function Nt(t,c){t&1&&(l(0,"mat-error",13),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be unique")," "))}function jt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Create")," ")}function Gt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Save Changes")," ")}var ut=(()=>{class t{data;dialogRef;fb;_webService;cdr;createJoinLinkForm;offerData={};offerJoinLinkData={};tempOfferJoinLinkData={};isUpdate;showError=!1;showLoader=!1;minDate=new Date;errorComponent;IConstant=new Q;constructor(e,i,o,p,v){this.data=e,this.dialogRef=i,this.fb=o,this._webService=p,this.cdr=v,this.offerData=e.offerData,this.isUpdate=e.isUpdate,this.createJoinLinkForm=this.fb.group({key:["",[S.required,this.uniqueKeyValidator(this.offerData.registration.links,this.isUpdate,this.data?.offerJoinLinkData?.key)]],expiration:[""],agent:["",[S.min(1),this.uniqueAgentValidator(this.offerData.registration.links,this.isUpdate,this.data?.offerJoinLinkData?.agent)]]}),this.setJoinFormData()}setJoinFormData(){this.isUpdate&&(this.offerJoinLinkData=JSON.parse(JSON.stringify(this.data.offerJoinLinkData)),this.tempOfferJoinLinkData=JSON.parse(JSON.stringify(this.data.offerJoinLinkData)),this.createJoinLinkForm.get("key")?.setValue(this.offerJoinLinkData.key),this.createJoinLinkForm.get("expiration")?.setValue(this.offerJoinLinkData.expiration),this.createJoinLinkForm.get("agent")?.setValue(this.offerJoinLinkData.agent),this.createJoinLinkForm.get("key")?.updateValueAndValidity(),this.createJoinLinkForm.get("expiration")?.updateValueAndValidity(),this.createJoinLinkForm.get("agent")?.updateValueAndValidity())}uniqueKeyValidator(e,i,o){return p=>{let v=p?.parent;if(!v)return null;let se=v.get("key")?.value||0;return e.some(F=>i&&F.key==o?!1:F.key==se)?{duplicateKeyMatch:!0}:null}}uniqueAgentValidator(e,i,o){return p=>{let v=p?.parent;if(!v)return null;let se=v.get("agent")?.value||0;return e.some(F=>i&&F.agent==o?!1:F.agent==se)?{agentAccountDuplicate:!0}:null}}get getControl(){return this.createJoinLinkForm.controls}createOrUpdateJoinLink(){if(this.createJoinLinkForm.invalid){this.showError=!0;return}this.showLoader=!0,this.showError=!1;let e=this.getJoinLinkParamObj();this._webService.updateOfferData(e).subscribe({next:i=>{this.showSuccessPopupMsg("Offer has been updated"),this.dialogRef.close({action:"refresh_offer_data"}),this.showLoader=!1},error:i=>{this.showLoader=!1,this.showErrorWarnMessage(this.IConstant.errorMessageObj[i?.error?.errorCode]),this.cdr.detectChanges()}})}getJoinLinkParamObj(){let e={},i={key:this.getControl.key.value?this.getControl.key.value:null,expiration:this.getExpirationDate(this.getControl.expiration.value),agent:this.getControl.agent.value?this.getControl.agent.value:null};if(e.registration=JSON.parse(JSON.stringify(this.offerData.registration)),!this.isUpdate)e.registration.links.push(i);else{let o=e.registration.links.findIndex(p=>p.key==this.tempOfferJoinLinkData.key);e.registration.links[o]=i}return e.offerId=this.offerData.id,e}getExpirationDate(e){if(e)if(e instanceof Date){let i=new Date().toISOString().split("T")[1];return`${this.getDateFormat(e)}T${i}`}else return e;else return null}getDateFormat(e){let i=new Date(e),o=i.getFullYear(),p=String(i.getMonth()+1).padStart(2,"0"),v=String(i.getDate()).padStart(2,"0");return`${o}-${p}-${v}`}copyJoinLink(){this.getControl.key.value&&this._webService.emitOnWebDataChange({action:"copy_offer_join_link",data:{key:this.getControl.key.value}})}showErrorWarnMessage(e){let i=this.errorComponent?.config;i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}showSuccessPopupMsg(e){let i=this.errorComponent?.config;i.customStyle="default-success-style",i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}closeDialog(){this.dialogRef.close({})}static \u0275fac=function(i){return new(i||t)(x(ie),x(te),x(X),x(L),x(ue))};static \u0275cmp=M({type:t,selectors:[["add-join-link-dialog"]],viewQuery:function(i,o){if(i&1&&y(E,5),i&2){let p;A(p=k())&&(o.errorComponent=p.first)}},standalone:!0,features:[Pe([{provide:Ue,useClass:We},{provide:qe,useValue:ze}]),w],decls:45,vars:29,consts:[["picker",""],["mat-dialog-title","",1,"text-center"],[1,"text-center"],[3,"formGroup"],[1,"mat-typography"],[1,"common-field"],["type","text","matInput","","placeholder","ABCD1234","formControlName","key"],["matTextSuffix","",3,"click"],["width","20","src","../.././../../../assets/icons/copy.png"],["class","pb-10",4,"ngIf"],[1,"common-field","datepicker-filter"],["matInput","","readonly","","formControlName","expiration",3,"min","matDatepicker"],["matSuffix","",3,"for"],[1,"pb-10"],["type","number","matInput","","placeholder","1","formControlName","agent"],[1,"d-flex","justify-center","g-20"],[1,"secondary-btn",3,"click"],["type","submit",1,"primary-btn",3,"click","IcmLoadingOverlay"]],template:function(i,o){if(i&1){let p=me();l(0,"h2",1),h(1,kt,2,3)(2,wt,2,3),r(),l(3,"p",2),h(4,Pt,2,3)(5,Rt,2,3),r(),l(6,"form",3)(7,"mat-dialog-content",4)(8,"mat-form-field",5)(9,"mat-label"),a(10),s(11,"translate"),r(),u(12,"input",6),l(13,"span",7),I("click",function(){return O(p),D(o.copyJoinLink())}),u(14,"img",8),r()(),h(15,Lt,3,3,"p",9)(16,Vt,3,3,"mat-error",9)(17,Tt,3,3,"mat-error",9),l(18,"mat-form-field",10)(19,"mat-label"),a(20),s(21,"translate"),r(),u(22,"input",11)(23,"mat-datepicker-toggle",12)(24,"mat-datepicker",null,0),r(),l(26,"p",13),a(27),s(28,"translate"),r(),l(29,"mat-form-field",5)(30,"mat-label"),a(31),s(32,"translate"),r(),u(33,"input",14),r(),h(34,Bt,3,3,"p",9)(35,Jt,3,3,"mat-error",9)(36,Nt,3,3,"mat-error",9),r(),l(37,"div",15)(38,"button",16),I("click",function(){return O(p),D(o.closeDialog())}),a(39),s(40,"translate"),r(),l(41,"button",17),I("click",function(){return O(p),D(o.createOrUpdateJoinLink())}),h(42,jt,2,3)(43,Gt,2,3),r()()(),u(44,"show-error-message")}if(i&2){let p=fe(25);n(),_(o.isUpdate?2:1),n(3),_(o.isUpdate?5:4),n(2),g("formGroup",o.createJoinLinkForm),n(4),m(d(11,19,"COMMON.Key")),n(5),g("ngIf",!o.showError||!(o.createJoinLinkForm.controls.key.errors!=null&&o.createJoinLinkForm.controls.key.errors.required)&&!(o.createJoinLinkForm.controls.key.errors!=null&&o.createJoinLinkForm.controls.key.errors.min)&&!(o.createJoinLinkForm.controls.key.errors!=null&&o.createJoinLinkForm.controls.key.errors.duplicateKeyMatch)),n(),g("ngIf",o.showError&&(o.createJoinLinkForm.controls.key.errors==null?null:o.createJoinLinkForm.controls.key.errors.required)),n(),g("ngIf",o.showError&&(o.createJoinLinkForm.controls.key.errors==null?null:o.createJoinLinkForm.controls.key.errors.duplicateKeyMatch)),n(3),m(d(21,21,"OFFERS.Expiration")),n(2),g("min",o.minDate)("matDatepicker",p),n(),g("for",p),n(4),f(" ",d(28,23,"PROVIDERS_PROFILE.Expiration date of the join link")," "),n(4),m(d(32,25,"COMMON.Agent")),n(3),g("ngIf",!o.showError||!(o.createJoinLinkForm.controls.agent.errors!=null&&o.createJoinLinkForm.controls.agent.errors.min)&&!(o.createJoinLinkForm.controls.agent.errors!=null&&o.createJoinLinkForm.controls.agent.errors.agentAccountDuplicate)),n(),g("ngIf",o.showError&&(o.createJoinLinkForm.controls.agent.errors==null?null:o.createJoinLinkForm.controls.agent.errors.min)),n(),g("ngIf",o.showError&&(o.createJoinLinkForm.controls.agent.errors==null?null:o.createJoinLinkForm.controls.agent.errors.agentAccountDuplicate)),n(3),m(d(40,27,"COMMON.Cancel")),n(2),g("IcmLoadingOverlay",o.showLoader),n(),_(o.isUpdate?43:42)}},dependencies:[re,ne,oe,dt,at,lt,st,Qe,q,U,G,j,ae,le,W,R,P,Z,H,B,N,J,K,$,Y,E,T,V,ee],styles:[".add-join-link-dialog{width:600px!important;border-radius:10px!important}  .add-join-link-dialog .mat-mdc-dialog-title{margin:unset!important;padding-bottom:10px!important}  .add-join-link-dialog .mat-mdc-dialog-surface{border-radius:10px!important;background:#fff!important;padding:20px!important}  .add-join-link-dialog .common-field{width:100%!important}  .add-join-link-dialog .common-field .mdc-text-field{background-color:#fff;border:1px solid;border-bottom:0px}  .add-join-link-dialog .common-field .mdc-text-field textarea{resize:none}  .add-join-link-dialog .common-field .mdc-text-field .mat-mdc-form-field-text-suffix{font-size:20px}  .mat-datepicker-content-container{background:#fff;border:1px solid #D0D5DD}"],changeDetection:0})}return t})();function Wt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Common Information")," ")}function zt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"COMMON.Filters")," ")}function Qt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"OFFERS.Public Agents")," ")}function Kt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"OFFERS.Fees")," ")}function Ht(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"OFFERS.Offer's settings")," ")}function $t(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"OFFERS.Setting up limitations for followers")," ")}function Yt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"PROVIDERS_PROFILE.Setting up public agents fee")," ")}function Xt(t,c){t&1&&(a(0),s(1,"translate")),t&2&&f(" ",d(1,1,"OFFERS.Setting up fees for the offer")," ")}function Zt(t,c){t&1&&(l(0,"p",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.The offer's title")," "))}function ei(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),m(d(2,1,"login.FieldRequired")))}function ti(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),m(d(2,1,"COMMON.Warn6CharMsg")))}function ii(t,c){if(t&1&&(l(0,"mat-form-field",7)(1,"mat-label"),a(2),s(3,"translate"),r(),u(4,"input",8),r(),h(5,Zt,3,3,"p",9)(6,ei,3,3,"mat-error",9)(7,ti,3,3,"mat-error",9),l(8,"mat-form-field",7)(9,"mat-label"),a(10),s(11,"translate"),r(),l(12,"mat-select",10)(13,"mat-option",11),a(14),s(15,"translate"),r(),l(16,"mat-option",11),a(17),s(18,"translate"),r()()(),u(19,"p",12),s(20,"translate"),l(21,"mat-form-field",7)(22,"mat-label"),a(23),s(24,"translate"),r(),u(25,"input",13),r(),l(26,"p",14),a(27),s(28,"translate"),r(),l(29,"mat-form-field",7)(30,"mat-label"),a(31),s(32,"translate"),r(),u(33,"textarea",15),r(),l(34,"p",14),a(35),s(36,"translate"),r()),t&2){let e=C();n(2),m(d(3,14,"OFFERS.Title")),n(3),g("ngIf",!e.showError||!(e.offerCommonInfoForm.controls.name.errors!=null&&e.offerCommonInfoForm.controls.name.errors.required)&&!(e.offerCommonInfoForm.controls.name.errors!=null&&e.offerCommonInfoForm.controls.name.errors.minlength)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.name.errors==null?null:e.offerCommonInfoForm.controls.name.errors.required)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.name.errors==null?null:e.offerCommonInfoForm.controls.name.errors.minlength)),n(3),f("",d(11,16,"PROVIDERS_PROFILE.Visibility")," *"),n(3),g("value","Public"),n(),m(d(15,18,"PROVIDERS_PROFILE.Public")),n(2),g("value","Private"),n(),m(d(18,20,"PROVIDERS_PROFILE.Private")),n(2),g("innerHTML",d(20,22,"PROVIDERS_PROFILE.OfferVisibility"),ke),n(4),m(d(24,24,"OFFERS.Summary")),n(4),m(d(28,26,"PROVIDERS_PROFILE.Offer's brief description visible publicly")),n(4),m(d(32,28,"PROVIDERS_PROFILE.Notes")),n(4),m(d(36,30,"PROVIDERS_PROFILE.Offer's description (verbose) visible publicly"))}}function ni(t,c){t&1&&(l(0,"p",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.A minimum balance a follower must have in order to join the provider by this offer")," "))}function oi(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be greater than 0")," "))}function ri(t,c){if(t&1&&(l(0,"mat-form-field",7)(1,"mat-label"),a(2),s(3,"translate"),r(),u(4,"input",16),l(5,"span",17),a(6,"%"),r()(),h(7,ni,3,3,"p",9)(8,oi,3,3,"mat-error",9)),t&2){let e=C();n(2),m(d(3,3,"OFFERS.Minimum balance")),n(5),g("ngIf",!e.showError||!(e.offerCommonInfoForm.controls.minBalance.errors!=null&&e.offerCommonInfoForm.controls.minBalance.errors.min)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.minBalance.errors==null?null:e.offerCommonInfoForm.controls.minBalance.errors.min))}}function ai(t,c){t&1&&(l(0,"p",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Agent fee paid as a percent of all fees to be received by provider")," "))}function li(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Value must be greater than 0")," "))}function si(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Total agent fee must not exceed 100%")," "))}function di(t,c){if(t&1&&(l(0,"mat-form-field",7)(1,"mat-label"),a(2),s(3,"translate"),r(),u(4,"input",18),l(5,"span",17),a(6,"%"),r()(),h(7,ai,3,3,"p",9)(8,li,3,3,"mat-error",9)(9,si,3,3,"mat-error",9)),t&2){let e=C();n(2),m(d(3,4,"PROVIDERS_PROFILE.Public Agents fee")),n(5),g("ngIf",!e.showError||!(e.offerCommonInfoForm.controls.fee.errors!=null&&e.offerCommonInfoForm.controls.fee.errors.min||e.offerCommonInfoForm.controls.fee.errors!=null&&e.offerCommonInfoForm.controls.fee.errors.totalFeeExceeds)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.fee.errors==null?null:e.offerCommonInfoForm.controls.fee.errors.min)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.fee.errors==null?null:e.offerCommonInfoForm.controls.fee.errors.totalFeeExceeds))}}function mi(t,c){t&1&&(l(0,"p",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.OfferPerformanceFeeHint")," "))}function fi(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"login.FieldRequired")," "))}function pi(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.Should have between 0 to 100 value")," "))}function ci(t,c){if(t&1&&(l(0,"mat-option",11),a(1),r()),t&2){let e=c.$implicit;g("value",e.value),n(),m(e.viewValue)}}function gi(t,c){t&1&&(l(0,"p",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"PROVIDERS_PROFILE.The periodicity of performance fee payments by followers")," "))}function ui(t,c){t&1&&(l(0,"mat-error",14),a(1),s(2,"translate"),r()),t&2&&(n(),f(" ",d(2,1,"login.FieldRequired")," "))}function hi(t,c){if(t&1&&(l(0,"mat-form-field",7)(1,"mat-label"),a(2),s(3,"translate"),r(),l(4,"mat-select",20),h(5,ci,2,2,"mat-option",21),r()(),h(6,gi,3,3,"p",9)(7,ui,3,3,"mat-error",9)),t&2){let e=C(2);n(2),m(d(3,4,"PROVIDERS_PROFILE.Interval")),n(3),g("ngForOf",e.intervalArr),n(),g("ngIf",!e.showError||!(e.offerCommonInfoForm.controls.interval.errors!=null&&e.offerCommonInfoForm.controls.interval.errors.required)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.interval.errors==null?null:e.offerCommonInfoForm.controls.interval.errors.required))}}function _i(t,c){if(t&1&&(l(0,"mat-form-field",7)(1,"mat-label"),a(2),s(3,"translate"),r(),u(4,"input",19),l(5,"span",17),a(6,"%"),r()(),h(7,mi,3,3,"p",9)(8,fi,3,3,"mat-error",9)(9,pi,3,3,"mat-error",9)(10,hi,8,6)),t&2){let e=C();n(2),m(d(3,5,"OFFERS.Performance fee")),n(5),g("ngIf",!e.showError||!(e.offerCommonInfoForm.controls.performance_fee.errors!=null&&e.offerCommonInfoForm.controls.performance_fee.errors.required)&&!(e.offerCommonInfoForm.controls.performance_fee.errors!=null&&e.offerCommonInfoForm.controls.performance_fee.errors.min||e.offerCommonInfoForm.controls.performance_fee.errors!=null&&e.offerCommonInfoForm.controls.performance_fee.errors.max)),n(),g("ngIf",e.showError&&(e.offerCommonInfoForm.controls.performance_fee.errors==null?null:e.offerCommonInfoForm.controls.performance_fee.errors.required)),n(),g("ngIf",e.showError&&((e.offerCommonInfoForm.controls.performance_fee.errors==null?null:e.offerCommonInfoForm.controls.performance_fee.errors.min)||(e.offerCommonInfoForm.controls.performance_fee.errors==null?null:e.offerCommonInfoForm.controls.performance_fee.errors.max))),n(),_(e.offerCommonInfoForm.controls.performance_fee.value>0?10:-1)}}var ht=(()=>{class t{data;dialogRef;fb;_webService;offerCommonInfoForm;offerData;modelType="";showError=!1;showLoader=!1;currentTotalAgentFee=0;intervalArr=[];errorComponent;IConstant=new Q;constructor(e,i,o,p){this.data=e,this.dialogRef=i,this.fb=o,this._webService=p,this.offerData=e.offerData,this.modelType=e.modelType,this.currentTotalAgentFee=this.getTotalAgentFee(),this.offerCommonInfoForm=this.fb.group({name:[""],visibility:[""],summary:[""],notes:[""],minBalance:[""],fee:[""],performance_fee:[""],interval:[""]}),this.setOfferFormData()}get getControl(){return this.offerCommonInfoForm.controls}setCustomValidationForInterval(){this.offerCommonInfoForm.get("performance_fee")?.valueChanges.subscribe(e=>{e>0?(this.offerCommonInfoForm.get("interval")?.setValidators([S.required]),this.offerCommonInfoForm.get("interval")?.updateValueAndValidity()):(this.offerCommonInfoForm.get("interval")?.setValue(""),this.offerCommonInfoForm.get("interval")?.clearValidators(),this.offerCommonInfoForm.get("interval")?.updateValueAndValidity())})}setInterValArr(){let e=this._webService.userPermissionConfig.provider.performanceFeeIntervalRights;this.intervalArr=Object.keys(e).filter(i=>e[i].length>0).map(i=>{let o=i.replace("allow","").replace("Interval","");return{value:o,viewValue:o}})}totalFeeValidator(e){return i=>{let o=i?.parent;return o&&(o.get("fee")?.value||0)+e>100?{totalFeeExceeds:!0}:null}}getTotalAgentFee(){let e=0;return this.offerData.additionalAgents.chain.length>0&&(e=this.offerData.additionalAgents.chain.reduce((i,o)=>i+o.share,0)),e}getOfferParamObj(){let e={};return this.modelType=="common_info"?(e.additional=this.offerData.additional,e.name=this.getControl.name.value,e.additional.summary=this.getControl.summary.value,e.additional.notes=this.getControl.notes.value,e.visibility=this.getControl.visibility.value):this.modelType=="filters"?(e.filters={},e.filters.minBalance=this.getControl.minBalance.value):this.modelType=="public_agents"?(e.publicAgents={},e.publicAgents.fee=this.getControl.fee.value):this.modelType=="performance_fees"&&(e.performance={},this.getControl.performance_fee.value>0?(e.performance.interval=this.getControl.interval.value,e.performance.fee=this.getControl.performance_fee.value):e.performance.fee=this.getControl.performance_fee.value),e.offerId=this.offerData.id,e}updateOfferDetails(){if(this.offerCommonInfoForm.invalid){this.showError=!0;return}this.showLoader=!0,this.showError=!1;let e=this.getOfferParamObj();this._webService.updateOfferData(e).subscribe({next:i=>{this.showSuccessPopupMsg("Offer has been updated"),this.dialogRef.close({action:"refresh_offer_data"}),this.showLoader=!1},error:i=>{this.showLoader=!1,this.showErrorWarnMessage(this.IConstant.errorMessageObj[i?.error?.errorCode])}})}setOfferFormData(){this.modelType=="common_info"?(this.offerCommonInfoForm.patchValue({name:this.offerData.name,visibility:this.offerData.visibility,summary:this.offerData.additional.summary,notes:this.offerData.additional.notes}),this.getControl.name.setValidators([S.required,S.minLength(6)]),this.getControl.name.updateValueAndValidity()):this.modelType=="filters"?(this.offerCommonInfoForm.patchValue({minBalance:this.offerData.filters.minBalance}),this.getControl.minBalance.setValidators([S.min(1)]),this.getControl.minBalance.updateValueAndValidity()):this.modelType=="public_agents"?(this.offerCommonInfoForm.patchValue({fee:this.offerData.publicAgents.fee}),this.getControl.fee.setValidators([S.min(1),this.totalFeeValidator(this.currentTotalAgentFee)]),this.getControl.fee.updateValueAndValidity()):this.modelType=="performance_fees"&&(this.setInterValArr(),this.setCustomValidationForInterval(),this.offerCommonInfoForm.patchValue({performance_fee:this.offerData.performance.fee,interval:this.offerData.performance.interval}),this.getControl.performance_fee.setValidators([S.required]),this.getControl.performance_fee.updateValueAndValidity()),this.offerCommonInfoForm.updateValueAndValidity()}showErrorWarnMessage(e){let i=this.errorComponent?.config;i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}showSuccessPopupMsg(e){let i=this.errorComponent?.config;i.customStyle="default-success-style",i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}closeOfferInfoForm(){this.dialogRef.close({})}static \u0275fac=function(i){return new(i||t)(x(ie),x(te),x(X),x(L))};static \u0275cmp=M({type:t,selectors:[["offer-commongInfo-dialog"]],viewQuery:function(i,o){if(i&1&&y(E,5),i&2){let p;A(p=k())&&(o.errorComponent=p.first)}},standalone:!0,features:[w],decls:24,vars:20,consts:[["mat-dialog-title","",1,"text-center"],[1,"text-center"],[3,"formGroup"],[1,"mat-typography"],[1,"d-flex","justify-center","g-20"],[1,"secondary-btn",3,"click"],["type","submit",1,"primary-btn",3,"click","IcmLoadingOverlay"],[1,"common-field"],["type","text","matInput","","placeholder","Offer 1","formControlName","name"],["class","pb-10",4,"ngIf"],["formControlName","visibility"],[3,"value"],[1,"pb-10",3,"innerHTML"],["type","text","matInput","","formControlName","summary"],[1,"pb-10"],["matInput","","formControlName","notes","rows","3","resi",""],["type","number","min","1","matInput","","placeholder","10000","formControlName","minBalance"],["matTextSuffix",""],["type","number","min","1","matInput","","placeholder","10000","formControlName","fee"],["type","number","min","0","max","100","matInput","","placeholder","1","formControlName","performance_fee"],["formControlName","interval"],[3,"value",4,"ngFor","ngForOf"]],template:function(i,o){i&1&&(l(0,"h2",0),h(1,Wt,2,3)(2,zt,2,3)(3,Qt,2,3)(4,Kt,2,3),r(),l(5,"p",1),h(6,Ht,2,3)(7,$t,2,3)(8,Yt,2,3)(9,Xt,2,3),r(),l(10,"form",2)(11,"mat-dialog-content",3),h(12,ii,37,32)(13,ri,9,5)(14,di,10,6)(15,_i,11,7),r(),l(16,"div",4)(17,"button",5),I("click",function(){return o.closeOfferInfoForm()}),a(18),s(19,"translate"),r(),l(20,"button",6),I("click",function(){return o.updateOfferDetails()}),a(21),s(22,"translate"),r()()(),u(23,"show-error-message")),i&2&&(n(),_(o.modelType=="common_info"?1:-1),n(),_(o.modelType=="filters"?2:-1),n(),_(o.modelType=="public_agents"?3:-1),n(),_(o.modelType=="performance_fees"?4:-1),n(2),_(o.modelType=="common_info"?6:-1),n(),_(o.modelType=="filters"?7:-1),n(),_(o.modelType=="public_agents"?8:-1),n(),_(o.modelType=="performance_fees"?9:-1),n(),g("formGroup",o.offerCommonInfoForm),n(2),_(o.modelType=="common_info"?12:-1),n(),_(o.modelType=="filters"?13:-1),n(),_(o.modelType=="public_agents"?14:-1),n(),_(o.modelType=="performance_fees"?15:-1),n(3),m(d(19,16,"COMMON.Cancel")),n(2),g("IcmLoadingOverlay",o.showLoader),n(),m(d(22,18,"COMMON.Save Changes")))},dependencies:[re,ne,oe,q,U,G,j,ae,le,W,Ce,he,R,Ve,P,Z,H,B,N,J,K,nt,it,$,Y,E,T,V,ee],styles:[".offer-commonInfo{width:600px!important;border-radius:10px!important}  .offer-commonInfo .mat-mdc-dialog-title{margin:unset!important;padding-bottom:10px!important}  .offer-commonInfo .mat-mdc-dialog-surface{border-radius:10px!important;background:#fff!important;padding:20px!important}  .offer-commonInfo .common-field{width:100%!important}  .offer-commonInfo .common-field .mdc-text-field{background-color:#fff;border:1px solid;border-bottom:0px}  .offer-commonInfo .common-field .mdc-text-field textarea{resize:none}  .offer-commonInfo .common-field .mdc-text-field .mat-mdc-form-field-text-suffix{font-size:20px}"],changeDetection:0})}return t})();var z=t=>({"btn-disable":t}),Ci=t=>["/portal/providers",t];function xi(t,c){if(t&1&&(l(0,"h6"),a(1),s(2,"translate"),r(),l(3,"p"),a(4),r()),t&2){let e=C(2);n(),m(d(2,3,"OFFERS.Performance fee")),n(3),we("",e.offerData.performance.fee,"% (",e.offerData.performance.interval,")")}}function Ii(t,c){t&1&&(l(0,"h6"),a(1),s(2,"translate"),r()),t&2&&(n(),m(d(2,1,"PROVIDERS_PROFILE.There are no fees")))}function vi(t,c){if(t&1){let e=me();l(0,"mat-card-content",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"h5"),a(5),r(),l(6,"p"),a(7),s(8,"translate"),r()(),l(9,"button",8),u(10,"img",9),a(11),s(12,"translate"),r(),l(13,"mat-menu",10,0)(15,"button",11),I("click",function(){O(e);let o=C();return D(o.openofferArchiveModal())}),u(16,"img",12),a(17),s(18,"translate"),r()()(),l(19,"div",13)(20,"div",14)(21,"div",15)(22,"div",16)(23,"h4"),a(24),s(25,"translate"),r(),l(26,"p"),a(27),s(28,"translate"),r(),l(29,"button",17),I("click",function(){O(e);let o=C();return D(o.openOfferCommonInfoDialog("common_info"))}),a(30),s(31,"translate"),r()(),l(32,"div",18)(33,"mat-card",19)(34,"div",20)(35,"h6"),a(36),s(37,"translate"),r(),l(38,"p"),a(39),r()(),l(40,"div",20)(41,"h6"),a(42),s(43,"translate"),r(),l(44,"p",21),a(45),r()(),l(46,"div",20)(47,"h6"),a(48),s(49,"translate"),r(),l(50,"p"),a(51),r()(),l(52,"div",20)(53,"h6"),a(54),s(55,"translate"),r(),l(56,"p"),a(57),r()()()()(),l(58,"div",15)(59,"div",16)(60,"h4"),a(61),s(62,"translate"),r(),l(63,"p"),a(64),s(65,"translate"),r(),l(66,"button",17),I("click",function(){O(e);let o=C();return D(o.openOfferCommonInfoDialog("performance_fees"))}),a(67),s(68,"translate"),r()(),l(69,"div",18)(70,"mat-card",19)(71,"div",20),h(72,xi,5,5)(73,Ii,3,3,"h6"),r()()()(),l(74,"div",15)(75,"div",16)(76,"h4"),a(77),s(78,"translate"),r(),l(79,"p"),a(80),s(81,"translate"),r(),l(82,"button",17),I("click",function(){O(e);let o=C();return D(o.openOfferCommonInfoDialog("filters"))}),a(83),s(84,"translate"),r()(),l(85,"div",18)(86,"mat-card",19)(87,"div",20)(88,"h6"),a(89),s(90,"translate"),r(),l(91,"p"),a(92),s(93,"currency"),r()()()()(),l(94,"div",15)(95,"div",16)(96,"h4"),a(97),s(98,"translate"),r(),l(99,"p"),a(100),s(101,"translate"),r(),l(102,"button",17),I("click",function(){O(e);let o=C();return D(o.openOfferCommonInfoDialog("public_agents"))}),a(103),s(104,"translate"),r()(),l(105,"div",18)(106,"mat-card",19)(107,"div",20)(108,"h6"),a(109),s(110,"translate"),r(),l(111,"p"),a(112),r()()()()(),l(113,"div",15)(114,"div",16)(115,"h4"),a(116),s(117,"translate"),r(),l(118,"p"),a(119),s(120,"translate"),r()(),l(121,"div",16)(122,"div",22)(123,"div",23)(124,"button",24),I("click",function(){O(e);let o=C();return D(o.openAddOrUpdateAgentModal(!1))}),u(125,"img",25),a(126),s(127,"translate"),r()()()()(),l(128,"div")(129,"div",26),u(130,"common-ag-grid",27),r()()(),l(131,"div",28)(132,"div",29)(133,"h4"),a(134),s(135,"translate"),r(),l(136,"p"),a(137),s(138,"translate"),r()(),u(139,"hr"),l(140,"div",30)(141,"mat-card",19)(142,"div",31)(143,"div",6)(144,"h6"),a(145),s(146,"translate"),r()(),l(147,"div",32)(148,"div",33)(149,"h6"),a(150),s(151,"translate"),r()(),l(152,"div",34)(153,"h6",21),a(154),r()()()(),l(155,"div",31)(156,"div",6)(157,"h6"),a(158),s(159,"translate"),r()(),l(160,"div",32)(161,"div",33)(162,"h6"),a(163),s(164,"translate"),r()(),l(165,"div",34)(166,"h6")(167,"a",35)(168,"span"),a(169),r()()()()(),l(170,"div",32)(171,"div",33)(172,"h6"),a(173),s(174,"translate"),r()(),l(175,"div",34)(176,"h6",21),a(177),r()()(),l(178,"div",32)(179,"div",33)(180,"h6"),a(181),s(182,"translate"),r()(),l(183,"div",34)(184,"h6"),a(185),s(186,"date"),r()()(),l(187,"div",32)(188,"div",33)(189,"h6"),a(190),s(191,"translate"),r()(),l(192,"div",34)(193,"h6"),a(194),s(195,"date"),r()()()()()()()(),l(196,"div",36)(197,"div",37)(198,"h4"),a(199),s(200,"translate"),r(),l(201,"p"),a(202),s(203,"translate"),r()(),l(204,"div",37)(205,"div",22)(206,"div",38)(207,"mat-form-field",39)(208,"mat-label"),a(209),s(210,"translate"),r(),l(211,"input",40),ge("ngModelChange",function(o){O(e);let p=C();return ce(p.filters.key,o)||(p.filters.key=o),D(o)}),I("ngModelChange",function(){O(e);let o=C();return D(o.filterJoinLinks("key"))}),r()(),l(212,"mat-form-field",41)(213,"mat-label"),a(214),s(215,"translate"),r(),l(216,"input",42),ge("ngModelChange",function(o){O(e);let p=C();return ce(p.filters.agent,o)||(p.filters.agent=o),D(o)}),I("ngModelChange",function(){O(e);let o=C();return D(o.filterJoinLinks("agent"))}),r()(),l(217,"mat-form-field",43)(218,"mat-label"),a(219),s(220,"translate"),r(),l(221,"mat-select",44),ge("ngModelChange",function(o){O(e);let p=C();return ce(p.filters.status,o)||(p.filters.status=o),D(o)}),I("selectionChange",function(){O(e);let o=C();return D(o.filterJoinLinks("status"))}),l(222,"mat-option",45),a(223),s(224,"translate"),r(),l(225,"mat-option",46),a(226),s(227,"translate"),r(),l(228,"mat-option",47),a(229,"-"),r()()()(),l(230,"div")(231,"h4",48),a(232,"|"),r()(),l(233,"div",23)(234,"button",24),I("click",function(){O(e);let o=C();return D(o.openAddOrUpdateJoinLinkModal(!1))}),u(235,"img",25),a(236),s(237,"translate"),r()()()()(),l(238,"div")(239,"div",26),u(240,"common-ag-grid",27),r()()()()}if(t&2){let e=fe(14),i=C();n(5),m(i.offerData.name),n(2),m(d(8,72,"OFFERS.General information about the offer")),n(2),g("matMenuTriggerFor",e)("ngClass",b(164,z,i.offerData.state=="Archived")),n(2),f(" ",d(12,74,"COMMON.Actions")," "),n(6),f(" ",d(18,76,"COMMON.Archive"),""),n(7),m(d(25,78,"OFFERS.Common Information")),n(3),m(d(28,80,"OFFERS.Offer's settings")),n(2),g("ngClass",b(166,z,i.offerData.state=="Archived")),n(),f(" ",d(31,82,"COMMON.Edit")," "),n(6),m(d(37,84,"OFFERS.Title")),n(3),m(i.offerData.name?i.offerData.name:"-"),n(3),m(d(43,86,"OFFERS.Visibility")),n(3),m(i.offerData.visibility?i.offerData.visibility:"-"),n(3),m(d(49,88,"OFFERS.Summary")),n(3),m(i.offerData.additional.summary?i.offerData.additional.summary:"-"),n(3),m(d(55,90,"PROVIDERS_PROFILE.Notes")),n(3),m(i.offerData.additional.notes?i.offerData.additional.notes:"-"),n(4),m(d(62,92,"OFFERS.Fees")),n(3),m(d(65,94,"OFFERS.Setting up fees for the offer")),n(2),g("ngClass",b(168,z,i.offerData.state=="Archived")),n(),f(" ",d(68,96,"COMMON.Edit")," "),n(5),_(i.offerData.performance.fee>0?72:73),n(5),m(d(78,98,"COMMON.Filters")),n(3),f("",d(81,100,"OFFERS.Setting up limitations for followers")," "),n(2),g("ngClass",b(170,z,i.offerData.state=="Archived")),n(),f(" ",d(84,102,"COMMON.Edit")," "),n(6),m(d(90,104,"OFFERS.Minimum balance")),n(3),m(i.offerData.filters.minBalance?Re(93,106,i.offerData.filters.minBalance,"USD","symbol"):"-"),n(5),m(d(98,110,"OFFERS.Public Agents")),n(3),f("",d(101,112,"PROVIDERS_PROFILE.Setting up public agents fee")," "),n(2),g("ngClass",b(172,z,i.offerData.state=="Archived")),n(),f(" ",d(104,114,"COMMON.Edit")," "),n(6),m(d(110,116,"OFFERS.Public agent fee")),n(3),m(i.offerData.publicAgents.fee?i.offerData.publicAgents.fee+"%":"-"),n(4),m(d(117,118,"OFFERS.Additional Agents")),n(3),m(d(120,120,"OFFERS.Setting up additional agents")),n(5),g("ngClass",b(174,z,i.offerData.state=="Archived")),n(2),f(" ",d(127,122,"COMMON.Add")," "),n(4),g("gridConfig",i.agentGridConfig)("gridData",i.agentGridData)("showGridLoader",i.showAgentGridLoder),n(4),m(d(135,124,"OFFERS.Offer's Join Links")),n(3),f("",d(138,126,"OFFERS.Setting up the offer's join links. Join link is the only way to follow a private provider")," "),n(8),m(d(146,128,"COMMON.Info")),n(5),m(d(151,130,"COMMON.State")),n(4),f("\u25CF ",i.offerData.state,""),n(4),m(d(159,132,"HOME.Provider")),n(5),m(d(164,134,"HOME.Nickname")),n(4),g("routerLink",b(176,Ci,i.providerData.id)),n(2),m(i.providerData.nickname),n(4),m(d(174,136,"COMMON.State")),n(4),f("\u25CF ",i.providerData.state,""),n(4),m(d(182,138,"OFFERS.Created (UTC)")),n(4),m(xe(186,140,i.offerData.createdUtc,"MMMM d, y 'at' hh:mm:ss a")),n(5),m(d(191,143,"OFFERS.Updated (UTC)")),n(4),m(xe(195,145,i.offerData.updatedUtc,"MMMM d, y 'at' hh:mm:ss a")),n(5),m(d(200,148,"OFFERS.Offer's Join Links")),n(3),f("",d(203,150,"OFFERS.Setting up the offer's join links. Join link is the only way to follow a private provider")," "),n(7),m(d(210,152,"COMMON.Key")),n(2),pe("ngModel",i.filters.key),n(3),m(d(215,154,"COMMON.Agent")),n(2),pe("ngModel",i.filters.agent),n(3),m(d(220,156,"COMMON.Status")),n(2),pe("ngModel",i.filters.status),n(2),m(d(224,158,"COMMON.Active")),n(3),m(d(227,160,"PROVIDERS_PROFILE.Expired")),n(8),g("ngClass",b(178,z,i.offerData.state=="Archived")),n(2),f(" ",d(237,162,"COMMON.Add")," "),n(4),g("gridConfig",i.offerJoinGridConfig)("gridData",i.offerJoinGridData)("showGridLoader",i.showOfferJoinGridLoder)}}function Oi(t,c){t&1&&(l(0,"div",49),u(1,"img",50),r())}var Mn=(()=>{class t{_webService;router;route;agentGridConfig={};agentGridData=[];showAgentGridLoder=!1;offerJoinGridConfig={};offerJoinGridData=[];showOfferJoinGridLoder=!1;offerId;offerData={};providerId;providerData={};showPageLoader=!1;filters={key:"",status:"",agent:""};offerArchiveDialog=de(_e);addAgentDialog=de(_e);offerCommonInfoDialog=de(_e);errorComponent;constructor(e,i,o){this._webService=e,this.router=i,this.route=o,this.route.paramMap.subscribe(p=>{this.offerId=p.get("offerId"),this.setMenuActive(),this.getAllOfferPageData()}),this._webService.subscribeOnWebDataChange("OffersStandALoneComponent",p=>{this.recieveChildrenEmitter(p)})}getAllOfferPageData(){return Ae(this,null,function*(){this.showPageLoader=!0;let e=yield this.getOfferData(),i=yield this.getProviderData();this.setupGridConfig("agents"),this.setupGridConfig("offerJoin"),this.showPageLoader=!1})}setMenuActive(){setTimeout(()=>{let e=document.querySelector("#provider-menu-relative");e&&e.classList.add("menu-active")},500)}getOfferData(){return new Promise(e=>{let i={offerId:this.offerId};this._webService.getSingleOfferData(i).subscribe({next:o=>{this.offerData=o,this.providerId=this.offerData.providerId,this.agentGridData=this.offerData.additionalAgents.chain,this.offerJoinGridData=this.offerData.registration.links,e()},error:o=>{this.showErrorWarnMessage(o?.error?.errorMessage),e()},complete:()=>{e()}})})}getProviderData(){return new Promise(e=>{let i={providerId:this.providerId};this._webService.getSingleProviderData(i).subscribe({next:o=>{this.providerData=o,e()},error:o=>{this.showErrorWarnMessage(o?.error?.errorMessage),e()},complete:()=>{e()}})})}setupGridConfig(e){if(e=="agents"){let i=this.getGridColDefs(e);this.agentGridConfig=this.getCommonGridConfig(i,"There are no agents")}else if(e=="offerJoin"){let i=this.getGridColDefs(e);this.offerJoinGridConfig=this.getCommonGridConfig(i,"There are no join links")}}getCommonGridConfig(e,i){return{maxHeight:"400px",noDataWarnMessage:i,gridOptions:{},agGridTheme:"ag-theme-alpine",pageSizeDropdownArr:[5,10,15],initialSelectedPageSize:5,columnDefination:e,enablePagination:!0,headerNameLangArr:e.map(p=>p.headerName),rowModelType:"clientSide",rowHeight:void 0}}getGridColDefs(e){if(e=="agents")return[{field:"externalAccount",sortable:!1,headerName:"COMMON.Agent",resizable:!1},{field:"share",sortable:!1,headerName:"PROVIDERS_PROFILE.Share",resizable:!1,valueFormatter:i=>`${i.value}%`},{field:"actions",headerName:"",sortable:!1,cellRenderer:Ie,colId:"agentActionCell",resizable:!1}];if(e=="offerJoin")return[{field:"key",headerName:"COMMON.Key",resizable:!1,colId:"offerKeyCell",cellRenderer:ve},{field:"expiration",headerName:"OFFERS.Expiration",resizable:!1,colId:"dateCell",cellRenderer:ve},{field:"status",sortable:!1,headerName:"COMMON.Status",resizable:!1,cellRenderer:mt},{field:"agent",headerName:"COMMON.Agent",resizable:!1,valueFormatter:i=>`${i.value?i.value:"-"}`},{field:"actions",headerName:"",sortable:!1,cellRenderer:Ie,colId:"offerJoinActionCell",resizable:!1}]}showErrorWarnMessage(e){let i=this.errorComponent?.config;i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}showSuccessPopupMsg(e){let i=this.errorComponent?.config;i.customStyle="default-success-style",i.message=e||i.message,this.errorComponent?.openErrorSnackbar()}recieveChildrenEmitter(e){e.action=="redirect_to_provider_page"?this.router.navigate([`/portal/providers/${this.offerData.providerId}`]):e.action=="copy_offer_join_link"?this.copyOfferJoinLink(e.data):e.action=="refresh_offer_data"?this.getOfferData():e.action=="update_agent_data"?this.openAddOrUpdateAgentModal(!0,e.data):e.action=="delete_agent_data"?this.openDeleteOfferDataModal("agent",e.data):e.action=="delete_offer_join_link"?this.openDeleteOfferDataModal("joinLink",e.data):e.action=="edit_offer_join_link"&&this.openAddOrUpdateJoinLinkModal(!0,e.data)}filterJoinLinks(e){e=="key"?this.offerJoinGridData=this.offerData.registration.links.filter(({key:i})=>i.toLowerCase().includes(this.filters.key.toLowerCase())):e=="agent"?this.offerJoinGridData=this.offerData.registration.links.filter(({agent:i})=>i==this.filters.agent||this.filters.agent==null):e=="status"&&(this.filters.status=this.filters.status=="-"?"":this.filters.status,this.offerJoinGridData=this.offerData.registration.links.filter(({status:i})=>i.toLowerCase().includes(this.filters.status.toLowerCase())))}copyOfferJoinLink(e){let i=`${window.location.origin}/portal/registration/subscription/${this.providerData.publicKey}/${e.key}`;navigator.clipboard.writeText(i).then(()=>{this.showSuccessPopupMsg("Join link is copied")}).catch(o=>{this.showErrorWarnMessage("Falied to copy Join link")})}openofferArchiveModal(){this.offerArchiveDialog.open(ft,{panelClass:"archive-dialog",data:{offerData:this.offerData,modelType:"offer"}}).afterClosed().subscribe(i=>{this.recieveChildrenEmitter(i)})}openAddOrUpdateAgentModal(e,i){this.addAgentDialog.open(gt,{panelClass:"add-agent-dialog",data:{offerData:this.offerData,isUpdate:e,offerFormData:i}}).afterClosed().subscribe(p=>{this.recieveChildrenEmitter(p)})}openAddOrUpdateJoinLinkModal(e,i){this.addAgentDialog.open(ut,{panelClass:"add-join-link-dialog",data:{offerData:this.offerData,isUpdate:e,offerJoinLinkData:i}}).afterClosed().subscribe(p=>{this.recieveChildrenEmitter(p)})}openDeleteOfferDataModal(e,i){this.addAgentDialog.open(pt,{panelClass:"delete-offer-dialog",data:{offerData:this.offerData,modelType:e,modelData:i}}).afterClosed().subscribe(p=>{this.recieveChildrenEmitter(p)})}openOfferCommonInfoDialog(e){this.offerCommonInfoDialog.open(ht,{panelClass:"offer-commonInfo",data:{offerData:this.offerData,modelType:e}}).afterClosed().subscribe(o=>{this.recieveChildrenEmitter(o)})}ngOnDestroy(){this._webService.unSubscribeOnWebDataChange("OffersStandALoneComponent")}static \u0275fac=function(i){return new(i||t)(x(L),x(Ne),x(Je))};static \u0275cmp=M({type:t,selectors:[["app-offers"]],viewQuery:function(i,o){if(i&1&&y(E,5),i&2){let p;A(p=k())&&(o.errorComponent=p.first)}},standalone:!0,features:[w],decls:4,vars:2,consts:[["actions","matMenu"],["appearance","outlined",1,"section-card"],["class","section-card-content",4,"ngIf"],["class","full-view-port-height d-flex justify-center align-center",4,"ngIf"],[1,"section-card-content"],[1,"home-card"],[1,"header","d-flex","justify-space-between","align-center"],[1,"header-title"],[1,"primary-btn","action-btn",3,"matMenuTriggerFor","ngClass"],["src","../../../../assets/icons/actions.png"],[1,"actions-menu"],["mat-menu-item","",3,"click"],["src","../../../../assets/icons/trashIcon.png","width","20","height","20"],[1,"info-section","d-flex","justify-space-between"],[1,"info-section-left"],[1,"d-flex","justify-space-between","w-100"],[1,"info-section-left-items"],[1,"edit-btn","info-section-btn",3,"click","ngClass"],[1,"info-section-left-items","info-section-left-items-card"],["appearance","outlined"],[1,"d-flex","justify-space-between","align-center"],[1,"status-badge"],[1,"d-flex","justify-right","g-10"],[1,"d-flex","justify-center","g-10","align-stretch"],[1,"primary-btn",3,"click","ngClass"],["src","../../../../assets/icons/plusIcon.png"],[1,"table"],[3,"gridConfig","gridData","showGridLoader"],[1,"info-section-right"],[1,"info-section-right-header"],[1,"info-section-right-card"],[1,"items"],[1,"d-flex","justify-center","items-main"],[1,"items-left"],[1,"items-right"],[1,"default-link",3,"routerLink"],[1,"d-flex","justify-space-between","w-100","pb-20"],[1,"info-section-left-items","padding-0"],[1,"d-flex","justify-space-between","g-10","common-dropdown"],[1,"offers-keyField"],["type","text","matInput","","placeholder","Key",3,"ngModelChange","ngModel"],[1,"offers-agentField"],["type","number","matInput","","placeholder","Agent",3,"ngModelChange","ngModel"],[1,"offers-statusSelect"],[3,"ngModelChange","selectionChange","ngModel"],["value","active"],["value","expired"],["value","-"],[1,"divider"],[1,"full-view-port-height","d-flex","justify-center","align-center"],["src","../../../../assets/logo/ICM Logo Default 1.png"]],template:function(i,o){i&1&&(l(0,"mat-card",1),h(1,vi,241,180,"mat-card-content",2)(2,Oi,2,0,"div",3),r(),u(3,"show-error-message")),i&2&&(n(),g("ngIf",!o.showPageLoader),n(),g("ngIf",o.showPageLoader))},dependencies:[R,Le,P,Be,Te,Ge,je,rt,ot,B,N,J,tt,E,et,Xe,Ye,Ze,T,V,W,G,j,Ce,he,q,U,$e,Ke,He],styles:[".stats-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.stats-info[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:20px}.stats-subline[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   .positive[_ngcontent-%COMP%]{color:#027a48}.stats-subline[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   .negative[_ngcontent-%COMP%]{color:#b42318}.info-section[_ngcontent-%COMP%]{padding-block:50px}.info-section[_ngcontent-%COMP%]   .info-section-left[_ngcontent-%COMP%]{width:70%}.info-section[_ngcontent-%COMP%]   .info-section-left[_ngcontent-%COMP%]   .info-section-left-items-card[_ngcontent-%COMP%]{border:2px solid #EAECF0;border-radius:10px;height:fit-content}.info-section[_ngcontent-%COMP%]   .info-section-left[_ngcontent-%COMP%]   .info-section-left-items-card[_ngcontent-%COMP%]   .mat-mdc-card[_ngcontent-%COMP%]{border:none!important}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]{width:25%}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:20px;margin:unset}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#667085}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:18px;margin:unset}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border-top:1px solid #EAECF0;margin-block:20px}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:15px}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]{padding-block:5px}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .items-main[_ngcontent-%COMP%]{width:100%;padding-block:10px}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .items-main[_ngcontent-%COMP%]   .items-left[_ngcontent-%COMP%]{padding:8px 20px;width:50%;border:1px solid #D0D5DD;border-top-left-radius:6px;border-bottom-left-radius:6px;color:#667085;font-weight:400}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .items-main[_ngcontent-%COMP%]   .items-right[_ngcontent-%COMP%]{padding:8px 20px;width:100%;border:1px solid #D0D5DD;border-top-right-radius:6px;border-bottom-right-radius:6px}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   .items[_ngcontent-%COMP%]   .items-main[_ngcontent-%COMP%]   .items-right[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{background:#ecfdf3;width:50%;padding:0 10px;border-radius:16px;color:#027a48}.info-section[_ngcontent-%COMP%]   .info-section-right[_ngcontent-%COMP%]   .info-section-right-card[_ngcontent-%COMP%]   .mat-mdc-card[_ngcontent-%COMP%]{border:none!important}  .subs-status-header .ag-header-cell-comp-wrapper .ag-header-cell-label{display:flex;justify-content:center}  .subs-volScaling-header .ag-header-cell-comp-wrapper .ag-header-cell-label{display:flex;justify-content:center}  .providerProfile-tabGroup .mdc-tab__text-label{font-size:20px!important;font-weight:400;color:#667085!important}  .providerProfile-tabGroup .mdc-tab{padding:0 50px!important}  .offers-statusSelect .mdc-text-field{background-color:#fff!important;border:1px solid;border-bottom:0px solid;width:150px}  .offers-agentField .mdc-text-field{background-color:#fff!important;border:1px solid;border-bottom:0px solid;width:150px}  .offers-keyField .mdc-text-field{background-color:#fff!important;border:1px solid;border-bottom:0px solid;width:150px}  .actions-menu .mat-mdc-menu-panel{background-color:#fff!important}  .actions-menu .mat-mdc-menu-content{background-color:#fff!important}  .actions-menu .mat-mdc-menu-item{padding-left:20px;padding-right:20px}  .actions-menu .mat-mdc-menu-item .mat-mdc-menu-item-text{font-size:17px!important;display:flex;gap:20px;align-items:center}  .common-dropdown .mdc-text-field{background-color:var(--primaryWhite)!important;border:1px solid var(--border-color)!important;border-bottom:0px!important;border-radius:8px!important;width:150px}  .common-dropdown .mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple:before{border-bottom-color:var(--border-color)!important}  .common-dropdown .mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple:before{border-bottom-color:var(--border-color)!important}  .mat-mdc-form-field-subscript-wrapper{display:none}.info-section-left-items[_ngcontent-%COMP%]{width:100%;padding:15px;height:fit-content}.info-section-left-items.padding-0[_ngcontent-%COMP%]{padding:0}.info-section-left-items[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:20px;margin:unset}.info-section-left-items[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#667085}.info-section-left-items[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:18px;margin:unset}.info-section-left-items[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{font-size:40px;padding-top:5px;color:#d0d5dd;font-weight:100}.status-badge[_ngcontent-%COMP%]{background:#ecfdf3;padding:0 10px;border-radius:16px;color:#027a48!important;width:fit-content}"]})}return t})();export{Mn as OffersStandALoneComponent};
