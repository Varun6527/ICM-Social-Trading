import{a as re}from"./chunk-AGXGLGFY.js";import{a as ie}from"./chunk-ZMEXDH5L.js";import{b as Z,c as H}from"./chunk-BUFGAGPR.js";import{g as ne}from"./chunk-KKB3U7AD.js";import{c as J,i as X,o as Y,q as ee,r as te,u as x,v as ae}from"./chunk-BBDCSVIU.js";import{a as V}from"./chunk-D2HZNMZZ.js";import{Aa as $,Ea as q,Ga as U,Ma as K,O as B,Oa as v,T as L,U as G,V as W,va as Q}from"./chunk-GPXXUB3O.js";import{$b as P,Da as h,Ha as _,Kc as z,Lc as k,Ma as y,O,Qa as o,R as N,Ra as s,Sa as g,Sb as j,Va as I,W as m,X as u,Ya as S,_a as p,eb as F,fb as R,gb as D,lb as l,mb as f,nb as C,oa as n,pa as M,qb as A,rb as b,sb as w,ub as E,yb as d,zb as c}from"./chunk-VFCAWHKN.js";function se(r,T){if(r&1){let e=I();o(0,"button",10),S("click",function(){m(e);let i=p(2);return u(i.clearFilters())}),g(1,"img",16),l(2),d(3,"translate"),s()}r&2&&(n(2),C(" ",c(3,1,"COMMON.Clear")," "))}function le(r,T){if(r&1){let e=I();o(0,"mat-form-field")(1,"mat-label"),l(2),d(3,"translate"),s(),o(4,"input",17),w("ngModelChange",function(i){m(e);let a=p(2);return b(a.selectedFilters.id,i)||(a.selectedFilters.id=i),u(i)}),s()(),o(5,"mat-form-field")(6,"mat-label"),l(7),d(8,"translate"),s(),o(9,"input",17),w("ngModelChange",function(i){m(e);let a=p(2);return b(a.selectedFilters.externalAccount,i)||(a.selectedFilters.externalAccount=i),u(i)}),s()(),o(10,"mat-form-field")(11,"mat-label"),l(12),d(13,"translate"),s(),o(14,"input",17),w("ngModelChange",function(i){m(e);let a=p(2);return b(a.selectedFilters.platformId,i)||(a.selectedFilters.platformId=i),u(i)}),s()(),o(15,"mat-form-field")(16,"mat-label"),l(17),d(18,"translate"),s(),o(19,"mat-select",18),w("ngModelChange",function(i){m(e);let a=p(2);return b(a.selectedFilters.ownerType,i)||(a.selectedFilters.ownerType=i),u(i)}),o(20,"mat-option",19),l(21),d(22,"translate"),s(),o(23,"mat-option",19),l(24),d(25,"translate"),s()()()}if(r&2){let e=p(2);n(2),f(c(3,12,"COMMON.Id")),n(2),A("ngModel",e.selectedFilters.id),n(3),f(c(8,14,"TRANSACTIONS.Account")),n(2),A("ngModel",e.selectedFilters.externalAccount),n(3),f(c(13,16,"TRANSACTIONS.MT order")),n(2),A("ngModel",e.selectedFilters.platformId),n(3),f(c(18,18,"TRANSACTIONS.Role")),n(2),A("ngModel",e.selectedFilters.ownerType),n(),_("value","Provider"),n(),f(c(22,20,"HOME.Provider")),n(2),_("value","Subscription"),n(),f(c(25,22,"TRANSACTIONS.Subscription"))}}function de(r,T){r&1&&(g(0,"img",20),l(1),d(2,"translate")),r&2&&(n(),C(" ",c(2,1,"PROVIDERS_LIST.Search")," "))}function ce(r,T){r&1&&(g(0,"img",21),l(1),d(2,"translate")),r&2&&(n(),C(" ",c(2,1,"COMMON.Refresh")," "))}function pe(r,T){if(r&1){let e=I();o(0,"mat-card-content",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"h5"),l(5),d(6,"translate"),s(),o(7,"p"),l(8),d(9,"translate"),s()()(),o(10,"div",7)(11,"div",8)(12,"div",9)(13,"button",10),S("click",function(){m(e);let i=p();return u(i.applyTransactFilter())}),g(14,"img",11),l(15),d(16,"translate"),s(),h(17,se,4,3,"button",12),s(),o(18,"div",13),h(19,le,26,24),o(20,"button",14),S("click",function(){m(e);let i=p();return u(i.refreshTransactDataList())}),h(21,de,3,3)(22,ce,3,3),s()()(),o(23,"common-ag-grid",15),S("emitToParent",function(i){m(e);let a=p();return u(a.recieveChildrenEmitter(i))}),s()()()()}if(r&2){let e=p();n(5),f(c(6,9,"TRANSACTIONS.Transaction History")),n(3),f(c(9,11,"TRANSACTIONS.List of fee payments")),n(7),C(" ",c(16,13,"COMMON.Filters")," "),n(2),_("ngIf",e.showFilters),n(2),y(e.showFilters?19:-1),n(2),y(e.selectedFilters.ownerType||e.selectedFilters.platformId||e.selectedFilters.externalAccount||e.selectedFilters.id?21:22),n(2),_("gridConfig",e.gridConfig)("gridData",e.transactionGridData)("showGridLoader",e.showGridLoader)}}function me(r,T){r&1&&(o(0,"div",22),g(1,"img",23),s())}var Le=(()=>{class r{_webService;transactionGridData=[];showLoader=!1;showGridLoader=!1;gridConfig;showFilters;selectedFilters={ownerType:"",platformId:"",externalAccount:"",id:""};sortApiKey={transactionTitlePopup:"id",externalAccount:"externalAccount",platformId:"platformId",transactionAmountViewDisplay:"amount",processTime:"processTime"};errorComponent;beTradeAccDetailDialog=O(J);hideAgGrid;gridApiObj;constructor(e){this._webService=e,this._webService.subscribeOnWebDataChange("TransactionsStandAloneComponent",t=>{this.recieveChildrenEmitter(t)}),this.setupTransactionGridConfig()}getTransactionsData(e){let t=this.getParamsForTransactApi(e.params.request);this._webService.getTransactionPageData(t).subscribe({next:i=>{this.transactionGridData=[],i.transactHistory.items.forEach(a=>this.transactionGridData.push(new ne(a,i.providerData))),this.sendDataToAgGrid(!0,e,i.transactHistory.count,this.transactionGridData)},error:i=>{this.sendDataToAgGrid(!1,e,0,[]),this.showErrorWarnMessage(i?.error?.errorMessage)}})}getParamsForTransactApi(e){let t={};return t.$count=!0,t.$top=e.endRow,t.$skip=e.startRow,this.getOrderByQuery(e.sortModel)&&(t.$orderby=this.getOrderByQuery(e.sortModel)),this.getFilterQuery()&&(t.$filter=this.getFilterQuery()),t}getFilterQuery(){let e="";return this.selectedFilters.ownerType&&(e+=`ownerType eq '${this.selectedFilters.ownerType}' and `),this.selectedFilters.platformId&&(e+=`platformId eq ${this.selectedFilters.platformId} and `),this.selectedFilters.externalAccount&&(e+=`externalAccount eq ${this.selectedFilters.externalAccount} and `),this.selectedFilters.id&&(e+=`id eq ${this.selectedFilters.id} and `),e?e.slice(0,-4):""}getOrderByQuery(e){if(e.length==0)return;let t="";return e.forEach(i=>{t+=`${this.sortApiKey[i.colId]} ${i.sort},`}),t.slice(0,-1)}sendDataToAgGrid(e,t,i,a){let oe={status:e,data:a,rowCount:i};t.callback(oe)}applyTransactFilter(){this.showFilters?(this.showFilters=!1,this.clearFilters()):this.showFilters=!0}clearFilters(){this.resetFilter(),this.gridApiObj.refreshServerSide()}refreshTransactDataList(){this.gridApiObj.refreshServerSide()}resetFilter(){this.selectedFilters={ownerType:"",platformId:"",externalAccount:"",id:""}}toggleLoadingOverlay(e,t){e=="showPageLoader"?(this.setupTransactionGridConfig(),this.showLoader=t):e=="showGridLoader"&&(this.showGridLoader=t)}showErrorWarnMessage(e){let t=this.errorComponent?.config;t.message=e||t.message,this.errorComponent?.openErrorSnackbar()}setupTransactionGridConfig(){let e=[{field:"transactionObj",headerName:"TRANSACTIONS.Transaction",cellRenderer:x,resizable:!1,width:150,suppressSizeToFit:!0,colId:"transactionTitlePopup"},{field:"externalAccount",headerName:"TRANSACTIONS.Account",resizable:!1,width:150,suppressSizeToFit:!0},{field:"platformId",headerName:"TRANSACTIONS.MT order",resizable:!1,width:150,suppressSizeToFit:!0},{field:"transactionAmountObj",headerName:"REPORTS.Amount",cellRenderer:x,resizable:!1,width:150,colId:"transactionAmountViewDisplay",suppressSizeToFit:!0},{field:"senderObj",headerName:"TRANSACTIONS.Sender",resizable:!1,width:150,sortable:!1,cellRenderer:x,colId:"transactionsenderAction",suppressSizeToFit:!0},{field:"reciepentObj",headerName:"TRANSACTIONS.Recipient",resizable:!1,width:150,sortable:!1,cellRenderer:x,colId:"transactionRecipientAction",suppressSizeToFit:!0},{field:"processTime",headerName:"TRANSACTIONS.Processed",resizable:!1,width:200,suppressSizeToFit:!0},{field:"actions",headerName:"",cellRenderer:ie,sortable:!1,colId:"transactionDetailsPopup",showPopupArraow:!0,resizable:!1}];this.setupGridConfig(e)}setupGridConfig(e){this.gridConfig={maxHeight:"400px",noDataWarnMessage:"There are no transactions",gridOptions:{},agGridTheme:"ag-theme-alpine",pageSizeDropdownArr:[25,50,100],initialSelectedPageSize:25,columnDefination:e,enablePagination:!0,headerNameLangArr:e.map(t=>t.headerName),rowModelType:"serverSide",rowHeight:void 0}}recieveChildrenEmitter(e){e.action=="open_transact_details_popup"?this.openBeTransactDetailsPopup(e.data):e.action=="get_server_side_data"?this.getTransactionsData(e):e.action=="set_grid_api_obj"&&(this.gridApiObj=e.data)}openBeTransactDetailsPopup(e){this.beTradeAccDetailDialog.open(re,{panelClass:"common-dialog",data:this.prepareTransactHistoryData(e)}),this.beTradeAccDetailDialog.afterAllClosed.subscribe(t=>{})}prepareTransactHistoryData(e){let t={mainTitle:"TRANSACTIONS.Transaction",secondryTitle:"TRANSACTIONS.InfoAboutTransact",labelDetails:[{title:"COMMON.State",value:e.transactionObj.state},{title:"SUBSCRIPTION.Trading account",value:e.externalAccount},{title:"TRANSACTIONS.MT order",value:e.platformId},{title:"TRANSACTIONS.Requested amount",value:e.transactionAmountObj,type:"transaction_amount"},{title:"TRANSACTIONS.Processed amount",value:e.processedAmountObj,type:"transaction_amount"},{title:"TRANSACTIONS.Reason",value:e.transactionObj.reason},{title:"TRANSACTIONS.Trading result",value:e.senderObj.reasonId,type:"trading_reason",redirectionUrl:`/portal/providers/${e.senderObj.providerId}/subscriptions/${e.senderObj.subscriptionId}/results/${e.senderObj.reasonId}`},{title:"TRANSACTIONS.Sender",value:e.senderObj,type:"sender"},{title:"TRANSACTIONS.Recipient",value:e.reciepentObj,type:"recipent"},{title:"TRANSACTIONS.Processed",value:e.processTime}]};return e.senderObj.ownerType!="Provider"&&t.labelDetails.splice(6,1),t}ngOnDestroy(){this._webService.unSubscribeOnWebDataChange("TransactionsStandAloneComponent")}static \u0275fac=function(t){return new(t||r)(M(V))};static \u0275cmp=N({type:r,selectors:[["app-transactions"]],viewQuery:function(t,i){if(t&1&&F(v,5),t&2){let a;R(a=D())&&(i.errorComponent=a.first)}},standalone:!0,features:[E],decls:4,vars:2,consts:[["appearance","outlined",1,"section-card"],["class","section-card-content",4,"ngIf"],["class","full-view-port-height d-flex justify-center align-center",4,"ngIf"],[1,"section-card-content"],[1,"home-card"],[1,"header","d-flex","justify-space-between","align-center"],[1,"header-title"],[1,"metrics-table"],[1,"header-buttons","d-flex","justify-space-between"],[1,"d-flex","g-20","justify-center","align-center"],[1,"secondary-btn",3,"click"],["src","../../../../assets/icons/filterIcon.svg"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"d-flex","g-20","common-dropdown","align-center"],[1,"refresh-btn",3,"click"],[3,"emitToParent","gridConfig","gridData","showGridLoader"],["width","20","src","../../../../assets/icons/clear-icon.svg"],["matInput","","type","number",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[3,"value"],["src","../../../../assets/icons/searchIcon.svg"],["src","../../../../assets/icons/rotateIcon.svg"],[1,"full-view-port-height","d-flex","justify-center","align-center"],["src","../../../../assets/logo/ICM Logo Default 1.png"]],template:function(t,i){t&1&&(o(0,"mat-card",0),h(1,pe,24,15,"mat-card-content",1)(2,me,2,0,"div",2),s(),g(3,"show-error-message")),t&2&&(n(),_("ngIf",!i.showLoader),n(),_("ngIf",i.showLoader))},dependencies:[P,j,v,k,z,W,L,G,te,Y,X,ee,B,K,Q,U,$,q,ae,H,Z],styles:[".common-dropdown .mdc-text-field{background-color:var(--primaryWhite)!important;border:1px solid var(--border-color)!important;border-bottom:0px!important;border-radius:8px!important;width:150px}  .common-dropdown .mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple:before{border-bottom-color:var(--border-color)!important}  .common-dropdown .mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple:before{border-bottom-color:var(--border-color)!important}  .mat-mdc-form-field-subscript-wrapper{display:none}.refresh-btn[_ngcontent-%COMP%]{background:#fff;color:#000;border-radius:8px;font-weight:500;font-size:18px;border:1px solid #D0D5DD;padding:12px 18px;display:flex;justify-content:space-between;gap:10px;align-items:center;cursor:pointer;min-height:56px;transition:background-color .3s linear,border-radius .3s linear,padding .3s linear,width .3s linear;margin-bottom:0}"]})}return r})();export{Le as a};
